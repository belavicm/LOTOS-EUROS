#!/bin/bash
# script search for missing data in file LEIP.archive generated by script "leip_tape"
# leip_check yyyy-mm-dd yyyy-mm-dd
# example: leip_check 2016-01-01 2016-12-31

# stop if "LEIP.archive"  does not exist
if [ ! -f "LEIP.archive" ]; then
    echo "'LEIP.archive' does not exist, make it with script 'leip_tape'"
    exit;
fi

#star/end date
date_start=$(date -I -d "${1} + 0 day")
date_end=$(date -I -d "${2} + 1 day")

#data names
data_sfc=(blh ci cp d2m lsp sd sf  ssr ssrd sstk swvl1 swvl2 swvl3 swvl4 t2m tcc u10 v10)
data_ml=(cc clwc q t u v)
data_fire=(FIRE)

#loop over date
while [ "${date_start}" != ${date_end} ]; do 

  #sfc
  for i in "${data_sfc[@]}"
  do
    if ! grep -q  "${i}_$(date -d "$date_start" "+%Y%m%d")_1h" LEIP.archive
    then
    # code if not found
    echo "Missing file: ${i}_$(date -d "$date_start" "+%Y%m%d")_1h"
    fi
  done
  
  #ml
  for i in "${data_ml[@]}"
  do
    if ! grep -q  "${i}_$(date -d "$date_start" "+%Y%m%d")_3h" LEIP.archive
    then
    # code if not found
    echo "Missing file: ${i}_$(date -d "$date_start" "+%Y%m%d")_3h"
    fi
  done
  
  #fire
  for i in "${data_fire[@]}"
  do
    if ! grep -q  "${i}_$(date -d "$date_start" "+%Y%m%d")" LEIP.archive
    then
    # code if not found
    echo "Missing file: ${i}_$(date -d "$date_start" "+%Y%m%d")"
    fi
  done  

  #date_start=date_start+1;
  date_start=$(date -I -d "$date_start + 1 day")

done
